{% extends "base/_layout.html" %}
{% set APPNAME = '琵琶金融' %}
{% set BODY_CLASS = 'skin-purple' %}
{% set LAYOUT_STYLE = 'fixed' %}
{% set body_main_header_large = '客户详情' %}
{% block head_more %}
    <!-- iCheck -->
    <link href="{{ url_for('static', filename='css/skins/skin-purple.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="/admin/static/admin/css/bootstrap3/admin.css" rel="stylesheet">
    <link href="/static/plugins/datatables/dataTables.bootstrap.css" rel="stylesheet">
    <script src="/static/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="/static/plugins/datatables/dataTables.bootstrap.min.js"></script>
{% endblock %}

{% block bread_crumb_title %}
<li><a href="/admin/customer">订单列表</a></li>
{% endblock %}

{% block body_content %}
    <div class="tab-content">
        <div class="active" id="customer_info">
            <div >
            <span><a href="/admin/customer/edit/?url=%2Fcustomer%2Finfo%2F{{customer.id}}&id={{customer.id}}" class="btn btn-success">编辑客户信息</a></span>
            </div>
            <h3>基本信息</h3>
            <div class="widget-container-span ui-sortable">
                <table class="table table-striped table-bordered table-hover model-list order_info">
                    <colgroup>
                      <col class="span2">
                      <col class="span7">
                    </colgroup>
                    <tbody><tr><td>微信ID</td><td style="color:#aaa">{{customer.openid}}</td></tr>
                    <tr><td>微信头像</td><td><img class="img-circle" style="width:50px;" src="{{customer.thumb_image()}}"></td></tr>
                    <tr><td>微信昵称</td><td>{{customer.nickname or ''}}</td></tr>
                    <tr><td>性别</td><td>{% if customer.sex==1%}男{%else%}女{%endif%}</td></tr>
                    <tr><td>客户电话</td><td>{{customer.phone or ''}}</td></tr>
                    <tr><td>客户城市</td><td>{{customer.city or ''}}</td></tr>
                    <tr><td>是否激活</td><td>{% if customer.active%}是{%else%}否{%endif%}</td></tr>
                    <tr><td>已登录</td><td>{% if customer.logined%}是{%else%}否{%endif%}</td></tr>
                    <tr><td>注册时间</td><td>{{customer.register_time or ''}}</td></tr>
                    <tr {%if customer.frequent == 1%}style="background-color:#F5F5C2;"{%endif%}><td>客户类型</td><td>{%if customer.frequent == 1%}老客户{%else%}新客户{%endif%}</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>地址列表</h3>
            <div class="widget-container-span ui-sortable">
                <table class="table table-striped table-bordered table-hover model-list order_items none">
                    <colgroup>
                      <col class="span1"><col class="span2"><col class="span2">
                      <col class="span1"><col class="span1"><col class="span6"><col class="span2">
                    </colgroup>
                    <tbody>
                    <tr><td>操作</td><td>联系人姓名</td><td>联系人电话</td><td>市</td><td>区</td><td>地址</td><td>是否默认</td></tr>
                    {%if address_list%}
                    {%for address in address_list %}
                    <tr {%if address.defaulted%}style="background-color:#F5F5C2"{%endif%}>
                        <td><a class="icon" style="color:#0088cc;" href="/admin/customeraddress/edit?id={{address.id}}url={{url}}" title="地址配置">
                        <span class="fa fa-pencil"></span>
                        </a>
                        <form class="icon" method="POST" action="/admin/customeraddress/delete/">
                            <input id="id" name="id" type="hidden" value="{{address.id}}">
                            <input id="url" name="url" type="hidden" value="/customer/info/{{customer.id}}">
                            <button style="color:#0088cc;" onclick="return confirm('你打算删除这条记录？');" title="删除纪录">
                                <span class="fa fa-trash"></span>
                            </button>
                        </form></td>
                        <td>{{address.name}}</td><td>{{address.phone}}</td><td>{{address.city}}</td><td>{{address.zone}}</td>
                        <td>{{address.address}}</td><td>{%if address.defaulted%}是{%else%}否{%endif%}</td>
                    </tr>
                    {%endfor%}
                    {%else%}<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
                    {%endif%}
                    </tbody>
                </table>
            </div>
            <h3>订单列表</h3>
            <div class="box">
                <div class="box-body">
                    <table id="example" class="table table-bordered table-hover">
                    <thead><tr><th>订单号</th><th>联系人</th><th>电话</th><th>件数/㎡</th><th>实际取衣时间</th><th>实际送衣时间</th><th>金额</th><th>订单状态</th><th>评价</th></tr></thead>
                    </table>
                </div><!-- /.box-body -->
            </div>
        </div>
    </div>
    <script>
    $(document).ready(function() {
        $('#example').dataTable( {
            "language": {"url": "/static/plugins/datatables/chinese.json"},
            "ajax": "/api/customer/{{customer.id}}/orders",
            "columns": [
                {"data": function(obj){return "<a href='/order/info/"+ obj.id+"'>"+obj.serial+"</a>";}},
                {"data":"name" },{"data":"phone" },{"data":"clothes"},{"data":"received_time" },
                {"data":"delivery_time" },{"data":function(obj){return "¥"+ obj.price}},
                {"data":"status" },{"data":"review" }
            ]
        } );
    });
    </script>
{% endblock%}